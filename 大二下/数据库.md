# 数据库

## 1.数据库系统概论

**数据库**：一种依照特定**数据模型**组织、存储和管理数据的文件集合。这些文件一般存放在**外部存储器**中，以便长久保存数据和快速访问。

**数据库特点**：

1. 数据**不重复**存放
2. 支持多个应用**并发访问**
3. 数据结构**独立**于应用程序
4. 对数据的增删改查均由**数据库系统管理软件**进行管理和控制，实现**复杂数据处理**

**数据模型**：描述**事物对象**数据**特征**及其**结构**的形式化表示，包含**数据结构**、**数据操作**、**数据约束**三个部分

1. **数据结构**：描述事物对象的**静态特征**，包括事物对象的数据组成、数据类型、数据性质等。
2. **数据操作**：描述事物对象的**动态特征**，包括数据的增删改查。
3. **数据约束**：描述数据结构中数据之间的**语义联系、制约和依存关系**。

| 分类 | 层次数据模型                                                 | 网状数据模型                             | 关系数据模型                                                 |
| ---- | ------------------------------------------------------------ | ---------------------------------------- | ------------------------------------------------------------ |
| 思想 | 采用“**树**”结构来组织、存储和管理数据。                     | 采用“**网状图**”结构组织、存储和管理数据 | 采用**二维表**结构组存储和管理数据，并以关**联列**实现表之间的联系 |
| 优点 | 1.层次清晰<br />2.结点更新更容易<br />3.检索查询效率高       | 1.容易表达数据间的复杂关系<br />2.冗余小 | 1.数据结构**简单**、操作**灵活**<br />2.支持**关系**与**集合**运算操作<br />3.支持广泛使用的**SQL数据库操作语言标准**<br />4.容易实现与应用程序的独立性 |
| 缺点 | 1.结构单一<br />2.相同信息多次储存，冗余大<br />3.不适合具有拓扑空间的数据组织 | 1.结构复杂<br />2.需要定位指针           | 1.只用于**结构化数据**的组织与存储管理<br />2.支持的数据类型较**简单**<br />3.难以支持**非结构化数据**和**复杂数据管理** |

**数据库系统**：一类基于**数据库**进行**数据管理**与**信息服务**的软件系统

1. **用户**：数据库系统系统的使用人员
2. **数据库应用程序**：在**DBMS**支持下对数据库中数据进行**访问处理**的应用程序
3. **数据库管理系统**：一种专门用来**创建**数据库、**管理**数据库、**维护**数据库并提供外部对数据库进行**访问**的软件、
4. **数据库**：依照特定数据模型组织、存储和管理数据的文件集合

**数据库应用结构**：单机用户结构、集中式结构、客户/服务器结构、分布式结构

**数据库生命周期**：需求分析、系统设计、系统实现、系统测试、系统运行与维护

## 2.关系模型

### 2.1相关概念

**实体**：指包含**数据特征的事物对象**在概念模型世界中的抽象名称

**关系**：指具有**关系特征**、用于**存放实体数据**的二维表

**键**：在关系中可以用来**唯一标识元组**的属性列

**外键**：在关联的两个关系这个，它们具有一个或多个相同属性，若关联列在第一个关系中作主键，则在第二个关系中作外键。

**主键作用**：

1. 唯一标识关系表的元组
2. 与关联表的**外键**建立联系，实现**关系表之间连接**
3. 数据库文件使用主键值来**组织关系表的数据存储**
4. 数据库使用主键索引快速**检索数据**

### 2.2关系模型

**关系模型**：一种基于**二维表**结构，存储**数据实体**以及**实体间联系**的数据模型

1. **数据结构**：表
2. **数据操作**：集合运算操作与专门的关系运算操作
3. **数据关系约束**：属性列取值是否唯一、范围

**关系模型完整性**：在关系数据模型中对关系实施的完整性约束

**作用**：消除关系表的元组**重复存储**、保持**关联表**的**数据一致性**、实现**业务数据规则**

1. **实体完整性约束**：在关系表中实施的**主键**取值约束，以保证每个元组被唯一识别（主键不可为空，不可重复）
2. **参照完整性约束**：**关系表**之间的数据约束（关系R中外键F与关系S中主键K关联，则F与K的值必须一致）
3. **用户自定义完整性约束**：用户根据具体业务对数据处理规则所定义的数据约束（列的范围，缺省值）

### 2.3数据库关系运算

**关系代数**：传统集合运算、专门关系运算

1. **选择**：行角度，σ_条件（表名）![image-20250424214454015](数据库.assets/image-20250424214454015.png)
2. **投影**：列角度，Π_(列名)（表名）![image-20250424214646054](数据库.assets/image-20250424214646054.png)
3. **连接**：按条件连接两个表，常用等值连接和自然连接（自然连接会删除重复列）![image-20250424215735342](数据库.assets/image-20250424215735342.png)![image-20250424215759425](数据库.assets/image-20250424215759425.png)![image-20250424215813735](数据库.assets/image-20250424215813735.png)
4. **除**：先找不同列的象集，再找被除表的投影，再找象集包含投影的就是结果![image-20250424220201691](数据库.assets/image-20250424220201691.png)除法必须有公共列并且不能有杂列![image-20250424221323141](数据库.assets/image-20250424221323141.png)

## 3.SQL语言

### 3.1概述

| 分类         | 语言                                                         |
| ------------ | ------------------------------------------------------------ |
| 数据定义语言 | CREATE DROP ALTER（库，表）                                  |
| 数据操作语言 | INSERT UPDATE DELETE（表）                                   |
| 数据查询语言 | SELECT                                                       |
| 数据控制语言 | GRANT DENY REVOKE（用户权限）                                |
| 事务处理语言 | BEGIN TRANSACTION//COMMIT//ROLLBACK（事务）                  |
| 游标控制语言 | DECLARE CURSOR-提交游标 FETCH INTO-提交游标数据 CLOSE CURSOR-关闭游标 |

### 3.2数据定义语句

**操作表**

~~~sql
#创建数据库
CREATE DATABASE data;
#修改数据库
ALTER DATABASE data RENAME TO base;
#删除数据库
DROP DATABASE data;
#创建表，列约束
CREATE TABLE Student
(
    StudentID     char(13)         PRIMARY KEY,
    StudentName   varchar(10)      NOT NULL UNIQUE,#唯一值
    StudnetGender char(2) NULL     CHECK(StuntGender IN('男','女')),#可选类型
    BirthDay      date NULL,
    Major         varchar(30) NULL DEFAULT '软件工程',#缺省值
    StudentPhone  char(11) NULL
);
#创建表，表约束，复合主键CONSTRAINT
CREATE  TABLE  Plan
( 
  CourseID  	char(4)  	NOT  NULL,
  TeacherID  	char(4)  	NOT  NULL,
  CourseRoom  	varchar(30),
  CourseTime  	varchar(30),
  Note  		varchar(50),
  CONSTRAINT	CoursePlan_PK	PRIMARY Key(CourseID,TeacherID)#复合主键
);
#表约束，代理主键serial
CREATE  TABLE  Plan
( 
  CoursePlanID	serial		    NOT  NULL,
  CourseID  	char(4)  		NOT  NULL,
  TeacherID  	char(4)  		NOT  NULL,
  CourseRoom  	varchar(30),
  CourseTime  	varchar(30),
  Note  		varchar(50),
  CONSTRAINT	CoursePlan_PK	PRIMARY Key(CoursePlanID)
);
#表约束，定义外键
CREATE  TABLE  Register
( 
  CourseRegID  	serial	        NOT  NULL,
  CoursePlanID  Int  		NOT  NULL,
  StudentID  	char(13),
  Note  		varchar(30),
  CONSTRAINT	CourseRegID_PK	PRIMARY Key(CourseRegID),
  CONSTRAINT	CoursePlanID_FK	FOREIGN Key(CoursePlanID)
	REFERENCES  Plan(CoursePlanID)
    ON DELETE CASCADE,#级联规则 主表记录删除从表自动删除
  CONSTRAINT	StudentID_FK	FOREIGN KEY(StudentID)
	REFERENCES  Student(StudentID)
    ON DELETE CASCADE
);

#修改表结构
#ADD修改方式
ALTER TABLE Student ADD email varchar(20) NOT NULL;
#DROP修改方式
ALTER TABLE Student DROP COLUMN name;
ALTER TABLE Student DROP CONSTRAINT name;
#RENAME修改方式
ALTER TABLE Student RENAME TO student;
ALTER TABLE Student RENAME name TO sname;
#ALTER修改方式
ALTER TABLE Student ALTER COLUMN name TYPE int;

#删除表结构
DROP TABLE Student;
~~~

**操作索引**

~~~sql
#创建索引
CREATE INDEX br ON STUDENT(birthday);
#修改索引
ALTER INDEX br RENAME TO brrr;
#删除索引
DROP INDEX br;
~~~

